*** Файловые системы
    *Файловая система* - это часть Операционной Системы включающая:
        1. Совокупность всех файлов на диске
        2. Набор структур данных используемых для управления файлами, такие как:
            * Каталоги
            * Дескрипторы
            * таблицы размещения файлов
        3. Комплекс системных и программных средств реализующие различные операции над файлами

    *Файл* - имнованая область внешней памяти
    *Каталог* - это специальный файл, содержащий ссылки на файлы

    Классификация: 
        1. Дисковые файловые системы:
            * FAT(12,16,32)
            * EXT(2,3,4)
            * JFS
            * NTFS

        2. Для твердотельных накопителей:
            Проверка при записи, если записано то же самое, то незачем перезаписывать.
            * exFAT

        3. Запись-ориентированные файловые системы:
            Старые ФС.
            * SFS (IBM) [структура файл сервер]
            * RSD (IRM) [разделенная поледовательность записи]

        4. Файловые системы для сетевых хранилищь данных:
            SAN - технология хранения данных, это не ФС
            * GFS [global filesystem] ориентирована на использование несколько ящиков с жесткими дисками. 
        
        5. Распределенные Файловые Системы:
            * NFS 
            * smb(Samba)

        6. Распределенные параллельные Файловые Системы:
            * GPFA 
            * GoogleFS
            * LustreFS

        7. Файловые системы точка-точка(point-to-point): 
            *
        8. Файловые системы специального назначения:
            * CD-ROM FS 
            * FTPFS 
            * GMailFS

        9. Шифрованные Файловые Системы
            * eCryptFs
            * SSHFS

        10. Файловые системы с защитой от сбоев:
            * ZFS

    Терминология: 
        
        *Сектор* - это минимальная единица хренения единицы информации на жестком диске и равна 512 байт
        *Кластер* - Минимальная единца хренения единицы информации для ФС, выбирается в момент высокоуровнего форматирования. Разсем кластера = 2**N(размер сектора)

        *CHS* - переход из N кластера => N поверхности, N цилиндра и N сектора
        *LBA* - каждый сектор имеет свой номер


*** Файловая система FAT
FAT - File Allocation Table таблица расположение файлов.
Разработана в 1977 году. Изначально ориентировалась для гибких магнитных дисков, но в дальнейшем она была адаптирована для работы с жесткими дисками.
Когда говорим FAT мы подразумеваем  fat 16, 16 это разрядность адресуемых класторов, ФАТ16 может адресовать 2**16 кластеров, также существует ФАТ32 и ФАТ12

FAT16 принимает следущее соглашение по именам файлов:
    1) Длина имени файлов не превышает 3х символов, за ним следует точка и необязательное расширение до 3х символов(краткий формат) 8.3 
    2) Регистр символов в именах файлов не различается и не сохраняется. 
    3) Имя файла должно начинатся с буквы или цифры и может содержать любой символ ASCII, за исключением пробелов и след. символов: \/[]:;|=,^*?
    4) FAT делит жесткий диск на следущии обязательные области:
        
        --------------------------------------------
        |  MBR  |  FAT  | FAT   | корн.| данные    |
        |       |  табл.| копия | кат. |           |
        --------------------------------------------

        1) MBR
        2) FAT таблица, которая содержит информацию о размещении файлов на логиеском диске.
        3) Копия FAT в MSDOS не умела пользоваться, была специальная утилита которая этим занималась.
        4) Корневой каталог жестко зафиксирован на жестком диске, внутри себя он может хранить информацию о 512 файлов. Одна запись о файле в любом каталоге занимает 32 байта:
            * Первые 8 байт  Имя файла
            * 3 байта        Расширения файла
            * 1 байта        Байт аттрибутов
            * 10 байта       Зарезервированы
            * 2 байта        Время создания\изменения
            * 2 байта        Дата создания\изменения
            * 4 байта        Размер файла
            * Область данных


        FAT16 может использовать кластера размером до 32Кбайт. 

        Максимальный размер Жесткого диска который может быть отформатирован - 2Гб
            
            32кб(2^15) * 2^16 = 2^31

        Максимальный размер файла - 4Гб

            размер файла - 4байта. 2^32 = 4Гб




            Недостатки:
                * Быстродействие зависит напрямую от количества файлов в каталоге.
                * Файловая система не хранит информацию о владельце и полномочиях доступа к файлу каталога.

    Появился  vFAT(virtual FAT). Она тоже 16 разрядная, было добавлено:
        1) Имя файла может быть длинной до 255 символов. 
        2) Имя может включать несколько пробелов и точек и текст после последней точки расматривается как расширение. 
        3) Регистр символов в именах файлов не различается, но сохраняется. 

    Алгоритм преобразования длинного имени в короткий:
        1) Из длинного имени удаляются все символы недопустимые в именах FAT. 
        1.2) Удаляются все точки из имени кроме последней.

        2) Обрезать полученную строку до 6и символов и дописать символы "~1"

        3) Строку после точки обрезать до точки

        4) Полученные буквы преобразовать в прописные и сравнить полученное с уже существующими, если совпадает, то к ~1 +1, получится ~2 и так далее, пока не будет уникальное. 

    Для хранения длинного имени файла используются стандартные 32х байтовы указатели.

    Для хранени длинных файлов байт аттрибутов устанавливался в значение - F, и значит следущие 26(байт) символов использовалось для хранения имени файлов, а хранилось всего 13 символов. 

    Преимущества:
        * Поддержка русских имен

    Недостатки:
        * При открытии файлов в старых программах, поэтому длинное имя затиралось, и нельяз было вернуть обратно.

* FAT 32
Это ФС которая поддерживает диски размером до 2Тб и принципальное отличие это увеличение разрядность адресуемых класторов. 

* Реально из 32 бит используется 28, остальные 4 зарезервированы на будущее.
* Снятие ограничения на размер корневого каталога. 

В FAT32  взависимости от размера логического диска выбирается фиксированные размер кластера.


<8Гб     - 4кб
8-16Гб   - 8кб
16-32Гб  - 16кб
>32Гб    - 32кб

Для того чтобы размер ФАТ таблицы был не слишком большой.

Недостки:
    * Большая FAT таблица, изза этого уменьшается быстродействие.

Преимущества:
    * Жесткие диски размером до 2Тб
    * Эффективнее организуется дисковое пространство, по сравнению с FAT16.
    * Корневой каталог не ограничен в размере, за счет возможности перемещать корневой каталог по жесткому диску. 
    * Наличие специальной зарезервированной области в которой содержится число свободных кластеров и номер последнего свободного кластера. 

*** NTFS
    NT File System
    Особенности относительно FAT:
        *поддерживает журналирование, что увеличивает надежность ФС
        *Права доступа

    Диск NTFS условно делится на 2 части. 
    1) Первые 12% диска отводятся под MFT зону - 12%
    2) Данные                                  - 88%

    NTFS не позволяет записывать данные в MFT зону.
    В MFT хранится вся служебная информация необходимая для функционирования NTFS

    После заполнения 88% HDD MFT уменьшается в 2 раза.
    Вся служебная информация в NTFS хранится в виде файлов. Этих файлов  со сслужебной информацией было придумано 16 штук. 
    С помощью обычных средств пользователи не могут увидеть. Не все файлы используются. 

    Любой файл в MFT со служебной информацие называется мета-файлом
    MFT файлы:
        * $MFT MasterFileTable
            ** содержит информацию о всех файлов и каталогов Жесткого Диска
        * $MFTmirr - Зеркало $MFT
            ** содержит копию первых 16 записей в MFT. $MFTmirr хранится ровно по средине жесткого диска
        * $LogFile  - Файл поддержки журнолирования
            **  Регистрируется все операции влеяющие на структуру раздела, создание удаления файла...
        * $Volume - файл со служебной информацией
            ** Служебная информация
        * $AttrDed - список стандартных аттрибутов файлов
            ** Так как версии NTFS различаются, 4-7
        * $. - Корневой каталог 
        * $Boot - файл содержащий загрузчик ОС 
            ** Раздел содержит загрузчик если раздел Загрузочный
        * $BitMap - содержит битовую карту диска.
            ** Показывает занят кластер(1 бит) или свободен
        * $Quota - содержит права пользователя на использование дискового пространства
        $ $UpCase - содержит таблицу соответсвия заглавных и прописных букв временах файлов на текущем диске.
            ** Используется для хранения всех символов в папке.

        * $BadClus - список плохих\сбойных кластеров
        * $Extend - это некоторый спец. каталог в который перемещаются MFT файлы если их размер слишком большой.

    Одна запись о файле занимает минимум 1кб.
    * Имя файла
    * Аттрибуты файла
    * Могут хранится данные(размер < 100 байт)

    Размер потока может быть до 4Гб

    MFT внутри себя повторно записи не использует, дло тех пор файл MFT не разростется до 12%
    
    Каталог NTFS - это некий специфичный файл который может быть виден командой dir.
    Каталог NTFS - имеет иерархическую структуру хранения информации, принцип иерархии - алфавит:
        a < A < b < B < ...
    
    NTFS фиксирует размер кластера Жесткого диска - 4 кб

    Есть функция сжатия файлов, но по умолчанию это все выключено.
    В NTFS журналирование основано на транзакциях.

    Транзакция - это действие которое выполнено полностью либо  не выполнено вообще. 

    NTFS при изменении структуры Жетского Диска создает запись в журнале транзакций, о том что будет выполнена эта операция, после этого начинается выполнение этой операции.

    При успешном выполнении операции делается отметка. 

    Если в момент запуска ФС находит незавершенные транзакции, она их полностью отменяет.

    В NTFS есть такое понятие как HardLink, а в NTFS она только заявлена, и нет возможности ее создать средствами Windows.

    В NTFS встроена функция шифрования является асимметричным. 

* Ext2
    Extended FileSystem
    Ext1 - 1991
    Ext2 - 1992

    Первоначально, Unix OS работала на основе Minix FS, она была 16и разрядной. И Ext разрабатывалась как ее замена.

    Длина имени файла - 255 символа
    В имени могут быть абчолютно все символы, кроме двух -> / Null

    В Ext выделяют 3 типа имен файлов:
        * Простое
        * Состовное
        * Относительное

    Полное имя файла - цепочка простых символьных имен всех каталогов, через которое проходит путь от корня до данного файла.
    Относительное - относительно какой то точки. 

    Единая точка монтирования -  /(корень)

    Аттрибутами файлами являются:
        * Списки доступа(какой пользователь, каким образом, что может сделать с этим файлом)
        * Владелец и группа
        * Время создания, последнего достпа, последнего изменения и последнего удаления
        * Текущий размер файла
        * Число блоков занимаемымх файлом
        * и т.д. 

        
   
        Типы: 
            * Файл 
            * Каталог
            * Байт арентированное
            * Блок ориентированное устройство
            * Символическая ссылка
            * Сокет
            * Именованый каталог

        Типы устройств:
            * Блок ориентированное
            * Байт ориентированное

        сокет - пара номер порта и IP адрес.

        Все аттрибуты файлов хранятся не в каталоге а в специальной информационной структуре которая называется как информационный узел(inforamtion node) Inode.

        В каталоге хранится минимальный набор информации:
            * Имени файла
            * Ссылка на этот информационный узел

* Структура HDD в Ext FS
    Unix оперирует термином - блоки, это тоже самое что и в Windows типо кластера, и является 2^N, Unix не используется большойразмер сокета, обычно больше.

    1) Суперблок - это элемент содержащий общую информацию о ФС. Распаложен в 1024 от начала раздела.

    Суперблок:
    * Общее число блоков и индексных дескрипторов(inode's) в Файловой Системе.
    * Число свободных блоков и inode's в файловой систем
    * Размер блока Файловой Системы
    * Количество блоков и индексных дескрипторов в группе
    * Размер inode
    * Идентификатор Файловой системы

    2) Описание группы блоков

    3) Битовая карта блока(показывает, занят или свободен блок)
    4) Битовая карта inode's
    5) Таблица inode's
    6) Сами данные

    Максимальный размер файла - 2Тб

* Ext3
    Принципиальное отличие, то что добавлено журналивароние. 
    Основана на транзакциях.
    Есть 3 режима журналирования:
        * Write back. Журналирование мета-данных, регистрируется изменения файловой системы(создание, удаление файлов)
        * Ordered. то же что и Write back, но транзакция закрывается только после окончания записи
        * Journal. Журналируются не только мета-данные но и данные пользователя. Самый медленный режим, но и самый надежный.

* Ext4 
    Адресация изменена с 32 до 64 бита.
    Все тоже самое что и из Ext3