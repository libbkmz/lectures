Управление памятью ОС
=====================

Типы адресов
------------

Три типа адресов:

1. Символьные - присваивает пользователь при написании программы на алгоритмичеком языке программирования либо ассемблере. К ним относятся имена переменных, имена функций и меток.

2. Виртуальные - вырабатывает транслятор, переводящий программу на машинный язык. Т.к. во время трансляции чаще всего неизвестно в какую область оперативной памяти будет загружена программа, то транслятор присваивает переменным и функциям виртуальные адреса (условные адреса), считая по умолчанию, что программа будет размещена с нулевого адреса.

   Совокупность виртуальных адресов процесса называется **виртуальным адресным пространством**. У каждого процесса собственное виртуальное адресное пространство, которое ограничено разрядностью архитектуры компьютера.

3. Физические - соответствует номерам ячеек оперативной памяти в которые действительно загружены данные.

   В некоторых случаях (в специализированных системах), когда заранее точно известно в какой области оперативной памяти будет выполняться программа, транслятор выдает исполняемый код сразу в физических адресах.

Существует два способа преобразования виртуальных адресов в физические:

1. Перемещающий загрузчик
             
            0       0E      1C
            -------------------------
            |     | a |   | b |     |                      - виртуальные адреса в программе
            -------------------------
            \     \   \   \   \      \
        ------------------------------------------
        |     |     | a |   | b |      |         |         - оперативная память
        ------------------------------------------
        0    038A    038A+   038A+
                     0E      0C     
               
   Перемещающий загрузчик на основании имеющихся у него исходных данных о начальном адресе физической памяти в который предстоит загружать программы и информация, предоставленная транслятором об адресно-зависимых константах программы выполняет загрузку программы в память, совмещая ее с заменой виртуальных адресов физическими.    
 
2. Динамическое преобразование      

            0       0E      1C
            -------------------------
            |     | a |   | b |     |                      - виртуальные адреса в программе
            -------------------------
            \     \   \   \   \      \
        ------------------------------------------
        |     |     | a |   | b |      |         |         - оперативная память
        ------------------------------------------
        0    038A     
  
   Программа загружается в оперативную память в неизменном виде в виртуальных адресах. Во время выполнения программы при каждом обращении к оперативной памяти происходит преобразование виртуального адреса в физический. Метод позволяет перемещать программу в оперативной памяти, в то же время расход на перерасчет виртуальных адресов в физические растет.

Классификация методов управления памятью
----------------------------------------

1. Без использования внешней памяти 

   * С фиксированными разделами
   
     Вся оперативная память делится на разделы фиксированного размера в момент установки ОС либо ее загрузки. В один раздел может быть загружен только один процесс
     
               --------------     -----
               | ОС | 1 | 2 | ... | n |  - оперативная память, n разделов = n процессов
               --------------     -----  
                                 
     Процесс, запущенный на выполнение добавляется в очередь процессов, которая может быть общей или персональной для каждого раздела памяти. Для преобразования виртуальных адресов в физический используется перемещающий загрузчик, потому что процесс загружался в память один раз (и навсегда (: )
     
     Недостатки:
     
       * Жесткость: сколько разделов - столько процессов (не больше)
       * Процесс, не помещающийся ни в одном из разделов не может быть выполнен
       * Неэффективное использование: процесс не занимает память на 100%
       
     Преимущества:
       
       * Простота реализации
   
   * С динамическими разделами 
     
               -------------------
               | ОС |            |  - оперативная память в момент загрузки ОС
               -------------------   

               ------------------     --------- 
               | ОС | П1 | П2   | ... | Пn    |  - оперативная память в момент выполнения процессов (у каждого процесса свой объем памяти)
               ------------------     ---------     
     
               ----------------------     --------------- 
               | ОС | П1 |\\\| П2   | ... |\\\\\| Пn    |  - оперативная память после некоторого времени выполнения процессов,
               ----------------------     ---------------    фрагментированные области - |\\\|  
     
     После загрузки ОС вся память является свободной (не разбитой на разделы). Каждому вновь поступившему на выполнение процессу выделяется столько памяти, сколько ему необходимо.
     
     **Фрагментация** - наличие большого числа несмежных участков памяти маленького размера.
     
     Недостатки:
     
       * Фрагментация
       
     Преимущества:
      
       * Количество одновременно запущенных процессов зависит от общего количества памяти и размера памяти процессов (увеличивается уровень мультипрограммирования)
       
     Задачи, которые выполняет ОС в данном методе:  
     
       1. Ведение таблиц свободных и занятых областей памяти
       2. При поступлении нового процесса анализ требований к оперативной памяти, выбор свободного раздела, загрузка в раздел процесса и корректировка таблиц свободных и занятых областей. 
       3. (При завершении процесса) Корректировка таблиц свободных и занятых областей                                 
     
   * С перемещающими разделами 
   
     В начале работает также как и метод с динамическими разделами. В определенное время (по расписанию или при нехватке памяти) происходит **дефрагментация разделов** - сдвиг занятых разделов в сторону старших или младших адресов.               
   
2. С использованием внешней памяти  

   * Страничное распределение памяти
   * Сегментное распределение памяти
   * Сегментно-страничное распределение памяти        

   
